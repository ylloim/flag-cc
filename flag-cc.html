<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../iron-image/iron-image.html">
<link rel="import" href="./countries-data.html">

<dom-module id="flag-cc">
  <template>
    <style>
      :host {
        display: inline-block;
        min-height: 5px;
        min-width: 5px;
      }
      iron-image {
        height: 100%;
        width: 100%;
      }
    </style>
    <countries-data data="{{_countries}}"></countries-data>

    <iron-image sizing="cover" title$="[[_flag_title]]" src$="[[_flag_src]]"></iron-image>
  </template>

  <script>
    /**
     * `flag-cc`
     * A simple component that displays the flag and some information about the currency and the country.
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class FlagCc extends Polymer.Element {
      static get is() { return 'flag-cc'; }
      static get properties() {
        return {
          code: {
            type: String
          },
          currency: {
            type: String
          },
          // Outputed country
          country: {
            type: Object,
            notify: true,
            readOnly: true
          },
          _countries: {
            type: Object
          },
          _flag_src: {
            type: String
          },
          _flag_title: {
            type: String
          },
          _debouncer: {
            type: Number
          },
        };
      }

      static get observers(){
        return [
          "_updateFlag(_countries, code, currency)"
        ]
      }

      _updateFlag( _countries, code, currency) {
        if(!_countries || (!code && !currency)){ return; }
        if( this._debouncer) { clearTimeout(this._debouncer); }
        this._debouncer = setTimeout( () => {
          var item = null;
          if(code) {
            code = code.toUpperCase();
            if(code.length == 2) {
              item = _countries.byCode2[code];
            } else if (code.length == 3){
              item = _countries.byCode3[code];
            } else {
              console.warn("FLAG-CC> unknown code", code);
            }
          } else if(currency) {
            currency = currency.toUpperCase();
            item = _countries.currencies[currency];
          }
          if(item) {
            this._flag_src = this.resolveUrl('flags/'+item.flag);
            this._flag_title = code ? item.name : item.currencyFull;
            this.countries = item;
          }
        }, 1);
      }
    }

    window.customElements.define(FlagCc.is, FlagCc);
  </script>
</dom-module>
